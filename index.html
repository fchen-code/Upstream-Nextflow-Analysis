<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>RNA-seq Upstream Pipeline (Nextflow)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Base styles -->
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 2rem; line-height: 1.6; max-width: 900px; }
    h1 { margin: 0 0 .25rem; }
    .meta { margin: 0 0 1rem; color: #444; }
    .box { border: 1px solid #e5e7eb; border-radius: 12px; padding: 16px; margin: 1rem 0; }
    .box h2 { margin: 0 0 .5rem; }
    ul { margin: .5rem 0 0 1.25rem; }
    a { text-decoration: none; }
    code { background: #f6f8fa; padding: 0 .25rem; border-radius: 4px; }
    pre { background: #0b1020; color: #e6e6e6; padding: 12px; border-radius: 8px; overflow: auto; }
    .btn { display: inline-block; margin-left:.5rem; padding:.25rem .5rem; border:1px solid #d1d5db; border-radius:.4rem; }
    .viewer { margin:.5rem 0 1rem; background:#0b1020; color:#e6e6e6; padding:12px; border-radius:8px; overflow:auto; display:none; }
  </style>

  <!-- highlight.js (optional for pretty colors) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
</head>
<body>

  <!-- Title + meta (tight spacing) -->
  <h1>RNA-seq Upstream Pipeline (Nextflow)</h1>
  <p class="meta">Author: Feng Chen · Date: 10/15/2025</p>

  <!-- Introduction -->
  <div class="box">
    <h2>Introduction</h2>
    <p>
      This project implements an upstream RNA-seq workflow using Nextflow DSL2. It automates the pipeline:
      FastQC → trimming → alignment → featureCounts → MultiQC. The workflow processes
      <strong>SRR13978643 (Saccharomyces cerevisiae)</strong> and includes all steps needed for reproducibility.
    </p>
    <ul>
      <li>Create environments:
        <code>conda env create -f setup.yml</code> and <code>conda env create -f samtools.yml</code>
      </li>
      <li>Activate:
        <code>conda activate DEseq</code>
      </li>
      <li>Download tools/data:
        <code>Rscript download.R</code>
      </li>
      <li>Run analysis:
        <code>nextflow run main.nf -with-conda</code>
      </li>
    </ul>
  </div>

  <!-- Code -->
  <div class="box">
    <h2>Code</h2>
    <ul>
      <!-- download.R -->
      <li>
        <strong>download.R</strong>
        <a href="#" class="btn" onclick="viewCode('./download.R','code-download','r');return false;">View</a>
        <a class="btn" href="./download.R" download>Download</a>
      </li>
      <pre id="pre-download" class="viewer"><code id="code-download" class="language-r">Loading…</code></pre>

      <!-- main.nf -->
      <li>
        <strong>main.nf</strong>
        <a href="#" class="btn" onclick="viewCode('./main.nf','code-main','groovy');return false;">View</a>
        <a class="btn" href="./main.nf" download>Download</a>
      </li>
      <pre id="pre-main" class="viewer"><code id="code-main" class="language-groovy">Loading…</code></pre>

      <!-- setup.yml -->
      <li>
        <strong>setup.yml</strong>
        <a href="#" class="btn" onclick="viewCode('./setup.yml','code-setup','yaml');return false;">View</a>
        <a class="btn" href="./setup.yml" download>Download</a>
      </li>
      <pre id="pre-setup" class="viewer"><code id="code-setup" class="language-yaml">Loading…</code></pre>

      <!-- samtools.yml (remove this block if you don't have the file) -->
      <li>
        <strong>samtools.yml</strong>
        <a href="#" class="btn" onclick="viewCode('./samtools.yml','code-samtools','yaml');return false;">View</a>
        <a class="btn" href="./samtools.yml" download>Download</a>
      </li>
      <pre id="pre-samtools" class="viewer"><code id="code-samtools" class="language-yaml">Loading…</code></pre>
    </ul>
  </div>

  <!-- Results -->
  <div class="box">
    <h2>Results</h2>
    <ul>
      <li><a href="./results/fastqc/index.html">FastQC report</a></li>
      <li><a href="./results/trimming/summary.html">Trimming summary</a></li>
      <li><a href="./results/alignment/metrics.html">Alignment metrics</a></li>
      <li><a href="./results/featurecounts/counts.txt">featureCounts (counts.txt)</a></li>
      <li><a href="./multiqc/index.html">MultiQC (combined QC)</a></li>
    </ul>
  </div>

  <!-- (Optional) Workflow DAG -->
  <div class="box">
    <h2>Workflow DAG</h2>
    <p><a href="./dag.png">Open DAG image</a></p>
  </div>

  <!-- Inline viewer JS -->
  <script>
    async function viewCode(path, codeId, lang) {
      const codeEl = document.getElementById(codeId);
      const preEl  = codeEl.parentElement;

      // Toggle closed if already visible
      if (preEl.style.display === 'block' && preEl.dataset.loaded === 'true') {
        preEl.style.display = 'none';
        return;
      }

      // Load once
      if (preEl.dataset.loaded !== 'true') {
        try {
          const res = await fetch(path, { cache: 'no-cache' });
          if (!res.ok) throw new Error('HTTP ' + res.status);
          const txt = await res.text();
          codeEl.textContent = txt;
          if (lang) codeEl.className = 'language-' + lang;
          if (window.hljs) hljs.highlightElement(codeEl);
          preEl.dataset.loaded = 'true';
        } catch (e) {
          codeEl.textContent = 'Failed to load ' + path + ': ' + e.message;
          preEl.dataset.loaded = 'true';
        }
      }
      preEl.style.display = 'block';
    }
  </script>

</body>
</html>
